; PlatformIO Project Configuration File
;
; ESP32-C6 Zigbee Environmental Sensor Project
; Target: DFRobot FireBeetle 2 ESP32-C6
;

[env:firebeetle2-esp32c6]
; Platform und Board Konfiguration
platform = espressif32@^6.5.0
board = esp32-c6-devkitm-1
framework = arduino

; CPU Frequenz
board_build.f_cpu = 160000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dio

; Partition Table für Zigbee
board_build.partitions = partitions.csv

; Build Flags
build_flags = 
    -D CORE_DEBUG_LEVEL=3
    -D CONFIG_LOG_DEFAULT_LEVEL=3
    -D CONFIG_ZIGBEE_ENABLED=1
    -D CONFIG_ZB_ENABLED=1
    -D CONFIG_ZB_ZED=1
    -D CONFIG_IEEE802154_ENABLED=1
    -D CONFIG_ESP_COEX_SW_COEXIST_ENABLE=1
    -D CONFIG_ZB_GP_ENABLED=0
    -D CONFIG_PM_ENABLE=1
    -D CONFIG_FREERTOS_USE_TICKLESS_IDLE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1
    -D ARDUINO_USB_MODE=1
    -D ESP32

; Zusätzliche Build Flags für Optimierung
build_unflags = 
    -Os

build_flags_extra = 
    -O2
    -ffunction-sections 
    -fdata-sections
    -Wl,--gc-sections

; Libraries
lib_deps = 
    adafruit/Adafruit BME280 Library@^2.2.4
    adafruit/Adafruit Unified Sensor@^1.1.14
    Wire
    SPI

; Monitor Konfiguration
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time
    colorize

; Upload Konfiguration
upload_speed = 921600
upload_port = COM*  ; Anpassen für Windows, z.B. COM3
; upload_port = /dev/ttyUSB*  ; Für Linux
; upload_port = /dev/cu.usbserial*  ; Für macOS

; Debug Konfiguration (optional)
debug_tool = esp-builtin
debug_init_break = tbreak setup

; Eigene Board-Variante für FireBeetle 2 ESP32-C6
[env:firebeetle2-esp32c6-ota]
extends = env:firebeetle2-esp32c6
upload_protocol = espota
upload_port = 192.168.1.100  ; IP-Adresse anpassen
upload_flags = 
    --port=3232
    --auth=password  ; OTA Passwort

; Test/Debug Umgebung ohne Deep Sleep
[env:firebeetle2-esp32c6-debug]
extends = env:firebeetle2-esp32c6
build_flags = 
    ${env:firebeetle2-esp32c6.build_flags}
    -D ENABLE_DEEP_SLEEP=0
    -D ENABLE_WIFI=1
    -D ENABLE_WEBSERVER=1
    -D CORE_DEBUG_LEVEL=5
    -D CONFIG_LOG_DEFAULT_LEVEL=5

; Produktion Umgebung mit Deep Sleep
[env:firebeetle2-esp32c6-production]
extends = env:firebeetle2-esp32c6
build_flags = 
    ${env:firebeetle2-esp32c6.build_flags}
    -D ENABLE_DEEP_SLEEP=1
    -D ENABLE_WIFI=0
    -D ENABLE_WEBSERVER=0
    -D CORE_DEBUG_LEVEL=1
    -D CONFIG_LOG_DEFAULT_LEVEL=1
    -O3  ; Maximale Optimierung

; Gemeinsame Einstellungen
[common]
lib_extra_dirs = 
    lib
    
; ESP-IDF Komponenten Pfad (falls benötigt)
; Hinweis: Für vollständige Zigbee-Unterstützung wird ESP-IDF empfohlen
; esp-idf Komponenten können hier eingebunden werden:
; extra_scripts = pre:scripts/copy_zigbee_libs.py